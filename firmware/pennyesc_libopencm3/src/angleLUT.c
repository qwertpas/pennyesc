#include "angleLUT.h"
#include <stdint.h>

// ==========================================
// CONFIGURATION: Match Python script settings
// ==========================================
#define LUT_BITS 8
#define SEGMENT_SIZE (1U << LUT_BITS)  // 256
#define SEGMENT_MASK (SEGMENT_SIZE - 1) // 255
#define TOTAL_LUT_SIZE (8 * SEGMENT_SIZE) // 2048

// ==========================================
// LOOKUP TABLE: Combined Octant+Linearization LUT
// ==========================================
// This table maps a pseudo-index (octant + slope) to corrected angle in radians.
// The table is generated by octant.py and corrects for magnetometer distortion
// (non-orthogonality, amplitude mismatch, phase shift).
// Size: 2048 entries (8 octants Ã— 256 segments per octant)
// Stored in flash memory (const) to save RAM
static const float OCTANT_LUT[TOTAL_LUT_SIZE] = {
0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f,
0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f,
0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f,
0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f,
0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.69813f, 0.70031f,
0.70250f, 0.70468f, 0.70686f, 0.70904f, 0.71122f, 0.71340f, 0.71558f, 0.71777f,
0.71995f, 0.72213f, 0.72431f, 0.72649f, 0.72867f, 0.73086f, 0.73304f, 0.73522f,
0.73740f, 0.73958f, 0.74176f, 0.74395f, 0.74613f, 0.74831f, 0.75049f, 0.75267f,
0.75485f, 0.75704f, 0.75922f, 0.76140f, 0.76358f, 0.76576f, 0.76794f, 0.77013f,
0.77231f, 0.77449f, 0.77667f, 0.77885f, 0.78103f, 0.78322f, 0.78540f, 0.78758f,
0.78976f, 0.79194f, 0.79412f, 0.79631f, 0.79849f, 0.80067f, 0.80285f, 0.80503f,
0.80721f, 0.80940f, 0.81158f, 0.81376f, 0.81594f, 0.81812f, 0.82030f, 0.82249f,
0.82467f, 0.82685f, 0.82903f, 0.83121f, 0.83339f, 0.83558f, 0.83776f, 0.83994f,
0.84212f, 0.84430f, 0.84648f, 0.84867f, 0.85085f, 0.85303f, 0.85521f, 0.85739f,
0.85957f, 0.86176f, 0.86394f, 0.86612f, 0.86830f, 0.87048f, 0.87266f, 0.87266f,
0.87266f, 0.87266f, 0.87266f, 0.87266f, 0.87266f, 0.87573f, 0.87879f, 0.88185f,
0.88491f, 0.88797f, 0.89104f, 0.89410f, 0.89716f, 0.90022f, 0.90328f, 0.90635f,
0.90941f, 0.91247f, 0.91553f, 0.91859f, 0.92166f, 0.92472f, 0.92778f, 0.93084f,
0.93390f, 0.93697f, 0.94003f, 0.94309f, 0.94615f, 0.94921f, 0.95228f, 0.95534f,
0.95840f, 0.96146f, 0.96452f, 0.96759f, 0.97065f, 0.97371f, 0.97677f, 0.97983f,
0.98290f, 0.98596f, 0.98902f, 0.99208f, 0.99514f, 0.99821f, 1.00127f, 1.00433f,
1.00739f, 1.01045f, 1.01352f, 1.01658f, 1.01964f, 1.02270f, 1.02576f, 1.02883f,
1.03189f, 1.03495f, 1.03801f, 1.04107f, 1.04414f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f, 1.04720f,
1.04720f, 1.05135f, 1.05551f, 1.05966f, 1.06382f, 1.06798f, 1.07213f, 1.07629f,
1.08044f, 1.08460f, 1.08875f, 1.09291f, 1.09706f, 1.10122f, 1.10538f, 1.10953f,
1.11369f, 1.11784f, 1.12200f, 1.12615f, 1.13031f, 1.13446f, 1.13862f, 1.14278f,
1.14693f, 1.15109f, 1.15524f, 1.15940f, 1.16355f, 1.16771f, 1.17186f, 1.17602f,
1.18018f, 1.18433f, 1.18849f, 1.19264f, 1.19680f, 1.20095f, 1.20511f, 1.20926f,
1.21342f, 1.21757f, 1.22173f, 1.22173f, 1.22173f, 1.22173f, 1.22570f, 1.22966f,
1.23363f, 1.23760f, 1.24156f, 1.24553f, 1.24950f, 1.25346f, 1.25743f, 1.26140f,
1.26536f, 1.26933f, 1.27330f, 1.27726f, 1.28123f, 1.28520f, 1.28916f, 1.29313f,
1.29710f, 1.30106f, 1.30503f, 1.30900f, 1.31296f, 1.31693f, 1.32090f, 1.32486f,
1.32883f, 1.33280f, 1.33676f, 1.34073f, 1.34470f, 1.34866f, 1.35263f, 1.35660f,
1.36056f, 1.36453f, 1.36850f, 1.37246f, 1.37643f, 1.38040f, 1.38436f, 1.38833f,
1.39230f, 1.39626f, 1.39626f, 1.39626f, 1.39922f, 1.40218f, 1.40514f, 1.40810f,
1.41105f, 1.41401f, 1.41697f, 1.41993f, 1.42289f, 1.42585f, 1.42880f, 1.43176f,
1.43472f, 1.43768f, 1.44064f, 1.44359f, 1.44655f, 1.44951f, 1.45247f, 1.45543f,
1.45839f, 1.46134f, 1.46430f, 1.46726f, 1.47022f, 1.47318f, 1.47613f, 1.47909f,
1.48205f, 1.48501f, 1.48797f, 1.49093f, 1.49388f, 1.49684f, 1.49980f, 1.50276f,
1.50572f, 1.50867f, 1.51163f, 1.51459f, 1.51755f, 1.52051f, 1.52347f, 1.52642f,
1.52938f, 1.53234f, 1.53530f, 1.53826f, 1.54121f, 1.54417f, 1.54713f, 1.55009f,
1.55305f, 1.55601f, 1.55896f, 1.56192f, 1.56488f, 1.56784f, 1.57080f, 1.57080f,
1.57080f, 1.57751f, 1.58422f, 1.59093f, 1.59765f, 1.60436f, 1.61107f, 1.61779f,
1.62450f, 1.63121f, 1.63792f, 1.64464f, 1.65135f, 1.65806f, 1.66478f, 1.67149f,
1.67820f, 1.68491f, 1.69163f, 1.69834f, 1.70505f, 1.71177f, 1.71848f, 1.72519f,
1.73190f, 1.73862f, 1.74533f, 1.74533f, 1.74533f, 1.75780f, 1.77026f, 1.78273f,
1.79520f, 1.80766f, 1.82013f, 1.83260f, 1.84506f, 1.85753f, 1.87000f, 1.88246f,
1.89493f, 1.90740f, 1.91986f, 1.91986f, 1.93233f, 1.94480f, 1.95726f, 1.96973f,
1.98220f, 1.99466f, 2.00713f, 2.01960f, 2.03206f, 2.04453f, 2.05700f, 2.06946f,
2.08193f, 2.09440f, 2.09440f, 2.09876f, 2.10312f, 2.10749f, 2.11185f, 2.11621f,
2.12058f, 2.12494f, 2.12930f, 2.13367f, 2.13803f, 2.14239f, 2.14675f, 2.15112f,
2.15548f, 2.15984f, 2.16421f, 2.16857f, 2.17293f, 2.17730f, 2.18166f, 2.18602f,
2.19039f, 2.19475f, 2.19911f, 2.20348f, 2.20784f, 2.21220f, 2.21657f, 2.22093f,
2.22529f, 2.22966f, 2.23402f, 2.23838f, 2.24275f, 2.24711f, 2.25147f, 2.25584f,
2.26020f, 2.26456f, 2.26893f, 2.26893f, 2.26893f, 2.28056f, 2.29220f, 2.30383f,
2.31547f, 2.32711f, 2.33874f, 2.35038f, 2.36201f, 2.37365f, 2.38528f, 2.39692f,
2.40855f, 2.42019f, 2.43183f, 2.44346f, 2.44346f, 2.45044f, 2.45742f, 2.46440f,
2.47139f, 2.47837f, 2.48535f, 2.49233f, 2.49931f, 2.50629f, 2.51327f, 2.52026f,
2.52724f, 2.53422f, 2.54120f, 2.54818f, 2.55516f, 2.56214f, 2.56912f, 2.57611f,
2.58309f, 2.59007f, 2.59705f, 2.60403f, 2.61101f, 2.61799f, 2.61799f, 2.61799f,
2.62259f, 2.62718f, 2.63177f, 2.63637f, 2.64096f, 2.64555f, 2.65014f, 2.65474f,
2.65933f, 2.66392f, 2.66852f, 2.67311f, 2.67770f, 2.68230f, 2.68689f, 2.69148f,
2.69607f, 2.70067f, 2.70526f, 2.70985f, 2.71445f, 2.71904f, 2.72363f, 2.72823f,
2.73282f, 2.73741f, 2.74200f, 2.74660f, 2.75119f, 2.75578f, 2.76038f, 2.76497f,
2.76956f, 2.77415f, 2.77875f, 2.78334f, 2.78793f, 2.79253f, 2.79253f, 2.79253f,
2.79649f, 2.80046f, 2.80443f, 2.80839f, 2.81236f, 2.81633f, 2.82029f, 2.82426f,
2.82823f, 2.83219f, 2.83616f, 2.84013f, 2.84409f, 2.84806f, 2.85203f, 2.85599f,
2.85996f, 2.86393f, 2.86789f, 2.87186f, 2.87583f, 2.87979f, 2.88376f, 2.88773f,
2.89169f, 2.89566f, 2.89963f, 2.90359f, 2.90756f, 2.91153f, 2.91549f, 2.91946f,
2.92343f, 2.92739f, 2.93136f, 2.93533f, 2.93929f, 2.94326f, 2.94723f, 2.95119f,
2.95516f, 2.95913f, 2.96309f, 2.96706f, 2.96706f, 2.96706f, 2.96706f, 2.97269f,
2.97832f, 2.98395f, 2.98958f, 2.99521f, 3.00084f, 3.00647f, 3.01210f, 3.01773f,
3.02336f, 3.02899f, 3.03462f, 3.04025f, 3.04588f, 3.05151f, 3.05714f, 3.06277f,
3.06840f, 3.07403f, 3.07966f, 3.08529f, 3.09092f, 3.09655f, 3.10218f, 3.10781f,
3.11344f, 3.11907f, 3.12470f, 3.13033f, 3.13596f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f, 3.14159f,
3.14159f, 3.14395f, 3.14631f, 3.14867f, 3.15103f, 3.15339f, 3.15574f, 3.15810f,
3.16046f, 3.16282f, 3.16518f, 3.16754f, 3.16990f, 3.17225f, 3.17461f, 3.17697f,
3.17933f, 3.18169f, 3.18405f, 3.18641f, 3.18876f, 3.19112f, 3.19348f, 3.19584f,
3.19820f, 3.20056f, 3.20292f, 3.20527f, 3.20763f, 3.20999f, 3.21235f, 3.21471f,
3.21707f, 3.21942f, 3.22178f, 3.22414f, 3.22650f, 3.22886f, 3.23122f, 3.23358f,
3.23593f, 3.23829f, 3.24065f, 3.24301f, 3.24537f, 3.24773f, 3.25009f, 3.25244f,
3.25480f, 3.25716f, 3.25952f, 3.26188f, 3.26424f, 3.26660f, 3.26895f, 3.27131f,
3.27367f, 3.27603f, 3.27839f, 3.28075f, 3.28311f, 3.28546f, 3.28782f, 3.29018f,
3.29254f, 3.29490f, 3.29726f, 3.29962f, 3.30197f, 3.30433f, 3.30669f, 3.30905f,
3.31141f, 3.31377f, 3.31613f, 3.31613f, 3.31613f, 3.31613f, 3.31613f, 3.31613f,
3.31869f, 3.32126f, 3.32383f, 3.32639f, 3.32896f, 3.33153f, 3.33409f, 3.33666f,
3.33923f, 3.34179f, 3.34436f, 3.34693f, 3.34949f, 3.35206f, 3.35463f, 3.35719f,
3.35976f, 3.36233f, 3.36489f, 3.36746f, 3.37003f, 3.37259f, 3.37516f, 3.37773f,
3.38029f, 3.38286f, 3.38543f, 3.38799f, 3.39056f, 3.39313f, 3.39569f, 3.39826f,
3.40083f, 3.40339f, 3.40596f, 3.40853f, 3.41109f, 3.41366f, 3.41623f, 3.41879f,
3.42136f, 3.42393f, 3.42649f, 3.42906f, 3.43163f, 3.43419f, 3.43676f, 3.43933f,
3.44189f, 3.44446f, 3.44703f, 3.44959f, 3.45216f, 3.45473f, 3.45729f, 3.45986f,
3.46243f, 3.46499f, 3.46756f, 3.47013f, 3.47269f, 3.47526f, 3.47783f, 3.48039f,
3.48296f, 3.48553f, 3.48809f, 3.49066f, 3.49066f, 3.49066f, 3.49066f, 3.49066f,
3.49178f, 3.49291f, 3.49404f, 3.49516f, 3.49629f, 3.49741f, 3.49854f, 3.49967f,
3.50079f, 3.50192f, 3.50304f, 3.50417f, 3.50530f, 3.50642f, 3.50755f, 3.50867f,
3.50980f, 3.51093f, 3.51205f, 3.51318f, 3.51430f, 3.51543f, 3.51656f, 3.51768f,
3.51881f, 3.51993f, 3.52106f, 3.52219f, 3.52331f, 3.52444f, 3.52557f, 3.52669f,
3.52782f, 3.52894f, 3.53007f, 3.53120f, 3.53232f, 3.53345f, 3.53457f, 3.53570f,
3.53683f, 3.53795f, 3.53908f, 3.54020f, 3.54133f, 3.54246f, 3.54358f, 3.54471f,
3.54583f, 3.54696f, 3.54809f, 3.54921f, 3.55034f, 3.55146f, 3.55259f, 3.55372f,
3.55484f, 3.55597f, 3.55709f, 3.55822f, 3.55935f, 3.56047f, 3.56160f, 3.56272f,
3.56385f, 3.56498f, 3.56610f, 3.56723f, 3.56835f, 3.56948f, 3.57061f, 3.57173f,
3.57286f, 3.57398f, 3.57511f, 3.57624f, 3.57736f, 3.57849f, 3.57961f, 3.58074f,
3.58187f, 3.58299f, 3.58412f, 3.58524f, 3.58637f, 3.58750f, 3.58862f, 3.58975f,
3.59087f, 3.59200f, 3.59313f, 3.59425f, 3.59538f, 3.59650f, 3.59763f, 3.59876f,
3.59988f, 3.60101f, 3.60213f, 3.60326f, 3.60439f, 3.60551f, 3.60664f, 3.60776f,
3.60889f, 3.61002f, 3.61114f, 3.61227f, 3.61339f, 3.61452f, 3.61565f, 3.61677f,
3.61790f, 3.61902f, 3.62015f, 3.62128f, 3.62240f, 3.62353f, 3.62465f, 3.62578f,
3.62691f, 3.62803f, 3.62916f, 3.63028f, 3.63141f, 3.63254f, 3.63366f, 3.63479f,
3.63591f, 3.63704f, 3.63817f, 3.63929f, 3.64042f, 3.64155f, 3.64267f, 3.64380f,
3.64492f, 3.64605f, 3.64718f, 3.64830f, 3.64943f, 3.65055f, 3.65168f, 3.65281f,
3.65393f, 3.65506f, 3.65618f, 3.65731f, 3.65844f, 3.65956f, 3.66069f, 3.66181f,
3.66294f, 3.66407f, 3.66519f, 3.66519f, 3.66519f, 3.66519f, 3.66762f, 3.67004f,
3.67246f, 3.67489f, 3.67731f, 3.67974f, 3.68216f, 3.68458f, 3.68701f, 3.68943f,
3.69186f, 3.69428f, 3.69670f, 3.69913f, 3.70155f, 3.70398f, 3.70640f, 3.70882f,
3.71125f, 3.71367f, 3.71610f, 3.71852f, 3.72095f, 3.72337f, 3.72579f, 3.72822f,
3.73064f, 3.73307f, 3.73549f, 3.73791f, 3.74034f, 3.74276f, 3.74519f, 3.74761f,
3.75003f, 3.75246f, 3.75488f, 3.75731f, 3.75973f, 3.76215f, 3.76458f, 3.76700f,
3.76943f, 3.77185f, 3.77427f, 3.77670f, 3.77912f, 3.78155f, 3.78397f, 3.78639f,
3.78882f, 3.79124f, 3.79367f, 3.79609f, 3.79852f, 3.80094f, 3.80336f, 3.80579f,
3.80821f, 3.81064f, 3.81306f, 3.81548f, 3.81791f, 3.82033f, 3.82276f, 3.82518f,
3.82760f, 3.83003f, 3.83245f, 3.83488f, 3.83730f, 3.83972f, 3.83972f, 3.83972f,
3.83972f, 3.83972f, 3.83972f, 3.84273f, 3.84574f, 3.84875f, 3.85176f, 3.85477f,
3.85778f, 3.86079f, 3.86380f, 3.86681f, 3.86982f, 3.87283f, 3.87583f, 3.87884f,
3.88185f, 3.88486f, 3.88787f, 3.89088f, 3.89389f, 3.89690f, 3.89991f, 3.90292f,
3.90593f, 3.90894f, 3.91194f, 3.91495f, 3.91796f, 3.92097f, 3.92398f, 3.92699f,
3.93000f, 3.93301f, 3.93602f, 3.93903f, 3.94204f, 3.94505f, 3.94806f, 3.95106f,
3.95407f, 3.95708f, 3.96009f, 3.96310f, 3.96611f, 3.96912f, 3.97213f, 3.97514f,
3.97815f, 3.98116f, 3.98417f, 3.98717f, 3.99018f, 3.99319f, 3.99620f, 3.99921f,
4.00222f, 4.00523f, 4.00824f, 4.01125f, 4.01426f, 4.01426f, 4.01426f, 4.01426f,
4.01426f, 4.01822f, 4.02219f, 4.02616f, 4.03012f, 4.03409f, 4.03806f, 4.04202f,
4.04599f, 4.04996f, 4.05392f, 4.05789f, 4.06186f, 4.06582f, 4.06979f, 4.07376f,
4.07772f, 4.08169f, 4.08566f, 4.08962f, 4.09359f, 4.09756f, 4.10152f, 4.10549f,
4.10946f, 4.11342f, 4.11739f, 4.12136f, 4.12532f, 4.12929f, 4.13326f, 4.13722f,
4.14119f, 4.14516f, 4.14912f, 4.15309f, 4.15706f, 4.16102f, 4.16499f, 4.16896f,
4.17292f, 4.17689f, 4.18086f, 4.18482f, 4.18879f, 4.18879f, 4.18879f, 4.18879f,
4.18879f, 4.19022f, 4.19165f, 4.19308f, 4.19451f, 4.19594f, 4.19737f, 4.19880f,
4.20023f, 4.20167f, 4.20310f, 4.20453f, 4.20596f, 4.20739f, 4.20882f, 4.21025f,
4.21168f, 4.21311f, 4.21454f, 4.21597f, 4.21740f, 4.21883f, 4.22026f, 4.22169f,
4.22312f, 4.22456f, 4.22599f, 4.22742f, 4.22885f, 4.23028f, 4.23171f, 4.23314f,
4.23457f, 4.23600f, 4.23743f, 4.23886f, 4.24029f, 4.24172f, 4.24315f, 4.24458f,
4.24601f, 4.24744f, 4.24888f, 4.25031f, 4.25174f, 4.25317f, 4.25460f, 4.25603f,
4.25746f, 4.25889f, 4.26032f, 4.26175f, 4.26318f, 4.26461f, 4.26604f, 4.26747f,
4.26890f, 4.27033f, 4.27176f, 4.27320f, 4.27463f, 4.27606f, 4.27749f, 4.27892f,
4.28035f, 4.28178f, 4.28321f, 4.28464f, 4.28607f, 4.28750f, 4.28893f, 4.29036f,
4.29179f, 4.29322f, 4.29465f, 4.29609f, 4.29752f, 4.29895f, 4.30038f, 4.30181f,
4.30324f, 4.30467f, 4.30610f, 4.30753f, 4.30896f, 4.31039f, 4.31182f, 4.31325f,
4.31468f, 4.31611f, 4.31754f, 4.31897f, 4.32041f, 4.32184f, 4.32327f, 4.32470f,
4.32613f, 4.32756f, 4.32899f, 4.33042f, 4.33185f, 4.33328f, 4.33471f, 4.33614f,
4.33757f, 4.33900f, 4.34043f, 4.34186f, 4.34329f, 4.34473f, 4.34616f, 4.34759f,
4.34902f, 4.35045f, 4.35188f, 4.35331f, 4.35474f, 4.35617f, 4.35760f, 4.35903f,
4.36046f, 4.36189f, 4.36332f, 4.36332f, 4.36332f, 4.36332f, 4.37302f, 4.38272f,
4.39241f, 4.40211f, 4.41180f, 4.42150f, 4.43120f, 4.44089f, 4.45059f, 4.46029f,
4.46998f, 4.47968f, 4.48937f, 4.49907f, 4.50877f, 4.51846f, 4.52816f, 4.53786f,
4.53786f, 4.53786f, 4.54387f, 4.54989f, 4.55591f, 4.56193f, 4.56795f, 4.57397f,
4.57998f, 4.58600f, 4.59202f, 4.59804f, 4.60406f, 4.61008f, 4.61609f, 4.62211f,
4.62813f, 4.63415f, 4.64017f, 4.64619f, 4.65221f, 4.65822f, 4.66424f, 4.67026f,
4.67628f, 4.68230f, 4.68832f, 4.69433f, 4.70035f, 4.70637f, 4.71239f, 4.71239f,
4.71239f, 4.71998f, 4.72757f, 4.73515f, 4.74274f, 4.75033f, 4.75792f, 4.76551f,
4.77310f, 4.78068f, 4.78827f, 4.79586f, 4.80345f, 4.81104f, 4.81863f, 4.82621f,
4.83380f, 4.84139f, 4.84898f, 4.85657f, 4.86416f, 4.87175f, 4.87933f, 4.88692f,
4.88692f, 4.89662f, 4.90631f, 4.91601f, 4.92571f, 4.93540f, 4.94510f, 4.95480f,
4.96449f, 4.97419f, 4.98388f, 4.99358f, 5.00328f, 5.01297f, 5.02267f, 5.03237f,
5.04206f, 5.05176f, 5.06145f, 5.06145f, 5.08085f, 5.10024f, 5.11963f, 5.13903f,
5.15842f, 5.17781f, 5.19720f, 5.21660f, 5.23599f, 5.23599f, 5.23599f, 5.23599f,
5.23599f, 5.23599f, 5.23599f, 5.23599f, 5.23599f, 5.23599f, 5.23599f, 5.23599f,
5.23599f, 5.23599f, 5.23599f, 5.23599f, 5.23599f, 5.25538f, 5.27477f, 5.29417f,
5.31356f, 5.33295f, 5.35234f, 5.37174f, 5.39113f, 5.41052f, 5.41052f, 5.42639f,
5.44225f, 5.45812f, 5.47399f, 5.48985f, 5.50572f, 5.52159f, 5.53745f, 5.55332f,
5.56919f, 5.58505f, 5.58505f, 5.59087f, 5.59669f, 5.60251f, 5.60832f, 5.61414f,
5.61996f, 5.62578f, 5.63160f, 5.63741f, 5.64323f, 5.64905f, 5.65487f, 5.66068f,
5.66650f, 5.67232f, 5.67814f, 5.68396f, 5.68977f, 5.69559f, 5.70141f, 5.70723f,
5.71304f, 5.71886f, 5.72468f, 5.73050f, 5.73632f, 5.74213f, 5.74795f, 5.75377f,
5.75959f, 5.75959f, 5.75959f, 5.76717f, 5.77476f, 5.78235f, 5.78994f, 5.79753f,
5.80512f, 5.81271f, 5.82029f, 5.82788f, 5.83547f, 5.84306f, 5.85065f, 5.85824f,
5.86582f, 5.87341f, 5.88100f, 5.88859f, 5.89618f, 5.90377f, 5.91135f, 5.91894f,
5.92653f, 5.93412f, 5.93412f, 5.94382f, 5.95351f, 5.96321f, 5.97290f, 5.98260f,
5.99230f, 6.00199f, 6.01169f, 6.02139f, 6.03108f, 6.04078f, 6.05047f, 6.06017f,
6.06987f, 6.07956f, 6.08926f, 6.09896f, 6.10865f, 6.10865f, 6.11592f, 6.12320f,
6.13047f, 6.13774f, 6.14501f, 6.15229f, 6.15956f, 6.16683f, 6.17410f, 6.18137f,
6.18865f, 6.19592f, 6.20319f, 6.21046f, 6.21774f, 6.22501f, 6.23228f, 6.23955f,
6.24682f, 6.25410f, 6.26137f, 6.26864f, 6.27591f, 6.28319f, 6.28319f, 0.00000f,
0.00147f, 0.00293f, 0.00440f, 0.00587f, 0.00733f, 0.00880f, 0.01027f, 0.01173f,
0.01320f, 0.01467f, 0.01613f, 0.01760f, 0.01907f, 0.02053f, 0.02200f, 0.02347f,
0.02493f, 0.02640f, 0.02787f, 0.02933f, 0.03080f, 0.03227f, 0.03373f, 0.03520f,
0.03667f, 0.03813f, 0.03960f, 0.04107f, 0.04253f, 0.04400f, 0.04547f, 0.04693f,
0.04840f, 0.04987f, 0.05133f, 0.05280f, 0.05427f, 0.05573f, 0.05720f, 0.05867f,
0.06013f, 0.06160f, 0.06307f, 0.06453f, 0.06600f, 0.06747f, 0.06893f, 0.07040f,
0.07187f, 0.07333f, 0.07480f, 0.07627f, 0.07773f, 0.07920f, 0.08067f, 0.08213f,
0.08360f, 0.08507f, 0.08653f, 0.08800f, 0.08947f, 0.09093f, 0.09240f, 0.09387f,
0.09533f, 0.09680f, 0.09827f, 0.09973f, 0.10120f, 0.10267f, 0.10413f, 0.10560f,
0.10707f, 0.10853f, 0.11000f, 0.11147f, 0.11293f, 0.11440f, 0.11587f, 0.11733f,
0.11880f, 0.12027f, 0.12173f, 0.12320f, 0.12467f, 0.12613f, 0.12760f, 0.12907f,
0.13053f, 0.13200f, 0.13347f, 0.13493f, 0.13640f, 0.13787f, 0.13933f, 0.14080f,
0.14227f, 0.14373f, 0.14520f, 0.14667f, 0.14813f, 0.14960f, 0.15107f, 0.15253f,
0.15400f, 0.15547f, 0.15693f, 0.15840f, 0.15987f, 0.16133f, 0.16280f, 0.16427f,
0.16573f, 0.16720f, 0.16867f, 0.17013f, 0.17160f, 0.17307f, 0.17453f, 0.17453f,
0.17453f, 0.17453f, 0.17453f, 0.17453f, 0.17453f, 0.17652f, 0.17850f, 0.18048f,
0.18247f, 0.18445f, 0.18643f, 0.18842f, 0.19040f, 0.19238f, 0.19437f, 0.19635f,
0.19833f, 0.20032f, 0.20230f, 0.20428f, 0.20627f, 0.20825f, 0.21023f, 0.21222f,
0.21420f, 0.21618f, 0.21817f, 0.22015f, 0.22213f, 0.22412f, 0.22610f, 0.22808f,
0.23007f, 0.23205f, 0.23403f, 0.23602f, 0.23800f, 0.23998f, 0.24197f, 0.24395f,
0.24593f, 0.24792f, 0.24990f, 0.25188f, 0.25387f, 0.25585f, 0.25783f, 0.25982f,
0.26180f, 0.26378f, 0.26577f, 0.26775f, 0.26973f, 0.27172f, 0.27370f, 0.27568f,
0.27767f, 0.27965f, 0.28163f, 0.28362f, 0.28560f, 0.28758f, 0.28957f, 0.29155f,
0.29353f, 0.29552f, 0.29750f, 0.29948f, 0.30147f, 0.30345f, 0.30543f, 0.30742f,
0.30940f, 0.31138f, 0.31337f, 0.31535f, 0.31733f, 0.31932f, 0.32130f, 0.32328f,
0.32527f, 0.32725f, 0.32923f, 0.33122f, 0.33320f, 0.33518f, 0.33717f, 0.33915f,
0.34113f, 0.34312f, 0.34510f, 0.34708f, 0.34907f, 0.34907f, 0.34907f, 0.34907f,
0.34907f, 0.35076f, 0.35245f, 0.35415f, 0.35584f, 0.35754f, 0.35923f, 0.36093f,
0.36262f, 0.36432f, 0.36601f, 0.36771f, 0.36940f, 0.37109f, 0.37279f, 0.37448f,
0.37618f, 0.37787f, 0.37957f, 0.38126f, 0.38296f, 0.38465f, 0.38634f, 0.38804f,
0.38973f, 0.39143f, 0.39312f, 0.39482f, 0.39651f, 0.39821f, 0.39990f, 0.40160f,
0.40329f, 0.40498f, 0.40668f, 0.40837f, 0.41007f, 0.41176f, 0.41346f, 0.41515f,
0.41685f, 0.41854f, 0.42023f, 0.42193f, 0.42362f, 0.42532f, 0.42701f, 0.42871f,
0.43040f, 0.43210f, 0.43379f, 0.43549f, 0.43718f, 0.43887f, 0.44057f, 0.44226f,
0.44396f, 0.44565f, 0.44735f, 0.44904f, 0.45074f, 0.45243f, 0.45412f, 0.45582f,
0.45751f, 0.45921f, 0.46090f, 0.46260f, 0.46429f, 0.46599f, 0.46768f, 0.46937f,
0.47107f, 0.47276f, 0.47446f, 0.47615f, 0.47785f, 0.47954f, 0.48124f, 0.48293f,
0.48463f, 0.48632f, 0.48801f, 0.48971f, 0.49140f, 0.49310f, 0.49479f, 0.49649f,
0.49818f, 0.49988f, 0.50157f, 0.50326f, 0.50496f, 0.50665f, 0.50835f, 0.51004f,
0.51174f, 0.51343f, 0.51513f, 0.51682f, 0.51852f, 0.52021f, 0.52190f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f,
0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f, 0.52360f
};

// ==========================================
// HELPER FUNCTIONS
// ==========================================

uint16_t angleLUT_get_size(void)
{
    return TOTAL_LUT_SIZE;
}

// ==========================================
// MAIN FUNCTION: Fast Angle Calculation
// ==========================================

float angleLUT_get_angle(int16_t x, int16_t y)
{
    // Step 1: Get absolute values (using int32 to prevent overflow)
    int32_t ax = (x < 0) ? -x : x;
    int32_t ay = (y < 0) ? -y : y;

    // Step 2: Determine octant and calculate scaled ratio
    // Octants: 0-7 covering 0-360 degrees in 45-degree segments
    // Ratio: min/max scaled to SEGMENT_SIZE for sub-octant resolution
    uint8_t octant;
    int32_t ratio_scaled;

    if (ax > ay) {
        // X is dominant (octants 0, 3, 4, 7)
        if (x >= 0) {
            octant = (y >= 0) ? 0 : 7;  // Quadrant I or IV
        } else {
            octant = (y >= 0) ? 3 : 4;  // Quadrant II or III
        }
        // Calculate ratio: (ay/ax) * SEGMENT_SIZE
        // Safe division: ax > 0 guaranteed if ax > ay
        ratio_scaled = (ay * SEGMENT_SIZE) / ax;
    } else {
        // Y is dominant (octants 1, 2, 5, 6)
        if (y >= 0) {
            octant = (x >= 0) ? 1 : 2;  // Quadrant I or II
        } else {
            octant = (x >= 0) ? 6 : 5;  // Quadrant IV or III
        }
        // Calculate ratio: (ax/ay) * SEGMENT_SIZE
        if (ay == 0) {
            ratio_scaled = 0;  // Handle edge case (both zero)
        } else {
            ratio_scaled = (ax * SEGMENT_SIZE) / ay;
        }
    }

    // Step 3: Handle zig-zag pattern for monotonicity
    // Even octants (0,2,4,6): angle increases as ratio increases
    // Odd octants (1,3,5,7): angle increases as ratio decreases
    // This creates a continuous index across octant boundaries
    uint16_t index_in_segment;
    if (octant & 1) {
        // Odd octant: reverse the ratio
        index_in_segment = (SEGMENT_SIZE - 1) - (uint16_t)ratio_scaled;
    } else {
        // Even octant: use ratio directly
        index_in_segment = (uint16_t)ratio_scaled;
    }

    // Clamp index to valid range (safety check)
    if (index_in_segment > SEGMENT_MASK) {
        index_in_segment = SEGMENT_MASK;
    }

    // Step 4: Calculate final lookup table index
    // Format: [octant (3 bits)][segment_index (8 bits)] = 11 bits total
    uint16_t total_index = ((uint16_t)octant << LUT_BITS) | index_in_segment;

    // Step 5: Bounds check and lookup
    if (total_index >= TOTAL_LUT_SIZE) {
        total_index = TOTAL_LUT_SIZE - 1;  // Clamp to last entry
    }

    return OCTANT_LUT[total_index];
}